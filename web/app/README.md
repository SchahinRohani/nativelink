# The NativeLink documentation

The NativeLink documentation gets deployed to <https://docs.nativelink.com>.

> [!CAUTION]
> Setup for working on these docs differs between Linux and Mac.
>
> For Linux: Use the Nix flake and run `bun install`.
>
> For Mac: If you're in the Nix flake, exit it, for instance with `direnv
> revoke`. Then manually install `bun`, run `bun install` and run `pnpm exec
> playwright install`.
>
> It's a long term goal to add the automated setup to Mac.

## üìö Stack

The NativeLink documentation uses a custom, highly efficient, high performance
stack. Getting a bunch of bleeding-edge tools to work well together can be
challenging. Feel free to copy-paste it into your own projects.

- [Di√°taxis](https://diataxis.fr/) as overarching documentation philosophy.
- [Bun](https://github.com/oven-sh/bun) as production bundler.
- [Biome](https://biomejs.dev/) as linting toolchain.
- [Astro](https://astro.build/) as meta-framework.
- [Qwik](https://qwik.dev/) as primary frontend-framework.
- [Starlight](https://starlight.astro.build/de/) as documentation framework.
- [TailwindCSS 4.0-alpha](https://tailwindcss.com/blog/tailwindcss-v4-alpha) for
  component styling which makes use of [LightningCSS](https://lightningcss.dev/)
  for faster CSS processing.
- [Deno Deploy](https://deno.com/deploy) for deployments.

## üöÄ Common workflows

See [`docs/package.json`](https://github.com/TraceMachina/nativelink/blob/main/docs/package.json)
for build scripts.

This project requires `pnpm`. The nix flake ships a compatible version.

```bash
# Install dependencies with pnpm. Don't install with bun.
bun install

# Rebuild the docs reference.
bun run docs.build

# Rebuild the simple parts of the autogenerated docs.
bun run docs.generate

# Generate and rebuild all parts of the autogenerated docs.
bun docs

# Rebuild everything. Make sure to remove the `dist` directory beforehand.
bun run build

# Run a development server. Doesn't rebuild the autogenerated parts of the docs.
bun dev

# Run formatter and linter checks.
bun check

# Apply formatter and linter fixes.
bun fix

# Test Deno deployments locally. Useful when debugging SSR. Rebuilds the
# autogenerated parts of the docs.
bun preview
```

When deploying to Cloudflare, make sure to set the `PNPM_VERSION` to `8.15.5` to
stay in sync with the flake. Also, use `pnpm exec playwright install && pnpm
build` on the Cloudflare worker. This sets up headless Chromium which to
generate mermaid diagrams during the build. You don't need to set playwright up
locally as it's already configured in the flake.

## üêõ Known issues

- `bun run docs.build` and therefore `bun docs` aren't working with the nix version of Bazel,
  The solution to this: Install Bun and Bazel on your host and build the docs outside the flake.
- `"@playform/compress": "=0.0.12"` because `0.0.13` doesn't compress CSS.
- `pagefind` isn't working
